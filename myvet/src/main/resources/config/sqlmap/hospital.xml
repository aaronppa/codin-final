<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.codin.repository.mapper.HosMapper">

	<resultMap type="Member" id="memberMap">
		<result column="member_no" property="memberNo"/>
		<result column="member_email" property="memberEmail"/>
		<result column="password" property="password"/>
		<result column="member_grade" property="memberGrade"/>
		<result column="member_name" property="memberName"/>
		<result column="member_phone" property="memberPhone"/>
		<result column="member_nickname" property="memberNickname"/>
		<result column="hos_code" property="hosCode"/>
		<result column="member_career" property="memberCareer"/>
		<result column="mailing_opt" property="mailingOpt"/>
		<result column="member_ori_name" property="memberOriName"/>
		<result column="member_sys_name" property="memberSysName"/>
		<result column="member_file_path" property="memberFilePath"/>
		<result column="member_file_size" property="memberFileSize"/>
		<result column="member_file_reg_date" property="memberFileRegDate"/>
	</resultMap>

	<resultMap type="Pet" id="petMap">
		<result column="pet_no" property="petNo"/>
		<result column="member_no" property="memberNo"/>
		<result column="pet_name" property="petName"/>
		<result column="pet_reg_no" property="petRegNo"/>
		<result column="species" property="species"/>
		<result column="breed" property="breed"/>
		<result column="size" property="size"/>
		<result column="pet_gender" property="petGender"/>
		<result column="pet_age" property="petAge"/>
		<result column="weight" property="weight"/>
		<result column="remark" property="remark"/>
		<result column="pet_ori_name" property="petOriName"/>
		<result column="pet_sys_name" property="petSysName"/>
		<result column="pet_file_path" property="petFilePath"/>
		<result column="pet_file_size" property="petFileSize"/>
		<association property="petOwner" column="member_no" select="selectMember"></association>
	</resultMap>

	<resultMap type="Hospital" id="hospitalMap">
		<result column="hos_code" property="hosCode"/>
		<result column="title" property="title"/>
		<result column="roadAddress" property="roadAddress"/>
		<result column="address" property="address"/>
		<result column="mapx" property="mapx"/>
		<result column="mapy" property="mapy"/>
		<result column="hos_search_cnt" property="hosSearchCnt"/>
		<result column="telephone" property="telephone"/>
		<result column="hos_register" property="hosRegister"/>
		<result column="lunch_start" property="lunchStart"/>
		<result column="lunch_end" property="lunchEnd"/>
		<result column="hos_homepage" property="hosHomepage"/>
		<result column="hos_comment" property="hosComment"/>		
	</resultMap>
	
	<resultMap type="HosFacility" id="facilityMap">
		<result column="facility_no" property="facilityNo"/>
		<result column="hos_code" property="hosCode"/>
		<result column="facility_code" property="facilityCode"/>
		<result column="facility_bookable" property="facilityBookable"/>
		<result column="staff_no" property="staffNo"/>
		<result column="max_booking" property="maxBooking"/>
	</resultMap>
	
	<resultMap type="HosFacilitylist" id="facilitylistMap">
		<result column="facility_code" property="facilityCode"/>		
		<result column="facility_name" property="facilityName"/>		
	</resultMap>
	
	<resultMap type="HosHours" id="hoursMap">
		<result column="hours_no" property="hoursNo"/>		
		<result column="hos_code" property="hosCode"/>		
		<result column="open_day" property="openDay"/>		
		<result column="open_time" property="openTime"/>		
		<result column="close_time" property="closeTime"/>		
		<result column="dayoff" property="dayoff"/>		
	</resultMap>
	
	<resultMap type="FileInfo" id="fileInfoMap">
		<result column="file_id" property="fileId"/>
		<result column="board_code" property="boardCode"/>
		<result column="board_no" property="boardNo"/>
		<result column="ori_name" property="oriName"/>
		<result column="sys_name" property="sysName"/>
		<result column="file_path" property="filePath"/>
		<result column="file_size" property="fileSize"/>
	</resultMap>
	
	<resultMap type="HosBlock" id="blockMap">
		<result column="block_code" property="blockCode"/>
		<result column="hos_code" property="hosCode"/>
		<result column="block_day" property="blockDay"/>
		<result column="block_no" property="blockNo"/>
		<result column="block_start" property="blockStart"/>
		<result column="block_end" property="blockEnd"/>
		<result column="max_booking" property="maxBooking"/>
	</resultMap>
	
	
	<select id="selectFileInfo" parameterType="int" resultMap="fileInfoMap">
		select *
		from file_info
		where file_id = #{fileId}
	</select>
	
	<select id="selectHospitalByNo" parameterType="int" resultMap="hospitalMap">
		select *
		from hos_basic
		where hos_code = #{hosCode}
	</select>
	
	<select id="selectMember" parameterType="int" resultMap="memberMap">
		select *
		from member
		where member_no = #{no}
	</select>
	
	<select id="searchPet" parameterType="HosPage" resultMap="petMap">
		select *
		from pet
		where pet_name like CONCAT('%',#{keyWord},'%')
		limit #{begin}, #{pageNum}
	</select>
	
	<select id="petCount" parameterType="string" resultType="int">
		select count(*)
		from pet
		where pet_name like CONCAT('%',#{keyWord},'%')
	</select>

	<insert id="insertHospital" parameterType="Hospital">
		insert into hos_basic
		(title, roadAddress, address, mapx, mapy, telephone)
		values
		(#{title}, #{roadAddress}, #{address}, #{mapx}, #{mapy}, #{telephone})
	</insert>
	
	<select id="selectFacility" resultMap="facilitylistMap">
		select *
		from hos_facilitylist
		order by facility_code
	</select>
	
	<select id="searchReg" parameterType="HosPage" resultMap="hospitalMap">
		select *
		from hos_basic
		where (
			<if test="searchType == 1">
				title like CONCAT('%',#{keyWord},'%')
			</if>
			<if test="searchType == 2">
				roadAddress like CONCAT('%',#{keyWord},'%') or
				address like CONCAT('%',#{keyWord},'%') 
			</if>
		) and hos_register = 'Y'
		limit #{begin}, #{pageNum}	
	</select>

	<select id="regCount" parameterType="HosPage" resultType="int">
		select count(*)
		from hos_basic
		where (
			<if test="searchType == 1">
				title like CONCAT('%',#{keyWord},'%')
			</if>
			<if test="searchType == 2">
				roadAddress like CONCAT('%',#{keyWord},'%') or
				address like CONCAT('%',#{keyWord},'%') 
			</if>
		) and hos_register = 'Y'
	</select>
	
	<select id="searchNor" parameterType="HosPage" resultMap="hospitalMap">
		select *
		from hos_basic
		where (
			<if test="searchType == 1">
				title like CONCAT('%',#{keyWord},'%')
			</if>
			<if test="searchType == 2">
				roadAddress like CONCAT('%',#{keyWord},'%') or
				address like CONCAT('%',#{keyWord},'%') 
			</if>
		) and hos_register = 'N'
		limit #{begin}, #{pageNum}	
	</select>

	<select id="norCount" parameterType="HosPage" resultType="int">
		select count(*)
		from hos_basic
		where (
			<if test="searchType == 1">
				title like CONCAT('%',#{keyWord},'%')
			</if>
			<if test="searchType == 2">
				roadAddress like CONCAT('%',#{keyWord},'%') or
				address like CONCAT('%',#{keyWord},'%') 
			</if>
		) and hos_register = 'N'
	</select>
	
	<select id="searchHos" parameterType="HosPage" resultMap="hospitalMap">
		select *
		from hos_basic
		where title like CONCAT('%',#{keyWord},'%')
		limit #{begin}, #{pageNum}
	</select>
	
	<select id="hosCount" parameterType="string" resultType="int">
		select count(*)
		from hos_basic
		where title like CONCAT('%',#{keyWord},'%')
	</select>
	
	<insert id="insertFacility" parameterType="HosFacility">
		insert into hos_facility
		(hos_code, facility_code)
		values
		(#{hosCode}, #{facilityCode})
	</insert>
	
	<insert id="insertDayoff" parameterType="HosHours">
		insert into hos_hours
		(hos_code, open_day, dayoff)
		values
		(#{hosCode},#{openDay},'Y')
	</insert>
	
	<update id="registerUpdate" parameterType="Hospital">
		update hos_basic
		set hos_register = 'Y',
			hos_comment = #{hosComment}
		where hos_code = #{hosCode}
	</update>
	
	<insert id="insertFileInfo" parameterType="FileInfo">
		insert into file_info
		(board_code, board_no, ori_name, sys_name, file_path, file_size)
		values
		(30, #{boardNo}, #{oriName}, #{sysName}, #{filePath}, #{fileSize})
	</insert>
	
	<select id="nextBlockNo" parameterType="int" resultType="int">
		select max(block_no)
		from hos_block
		where hos_code = #{hosCode}
	</select>
	
	<select id="isCreateBlock" parameterType="HosBlock" resultType="int">
		select count(*)
		from hos_block
		where hos_code = #{hosCode} and
			  block_day = #{blockDay}
	</select>
	
	
	<insert id="createBlock" parameterType="HosBlock">
		insert into hos_block
		(hos_code, block_day, block_no, block_start, block_end, facility_no, max_booking)
		values
		(#{hosCode}, #{blockDay}, #{blockNo}, #{blockStart}, #{blockEnd}, #{facilityNo}, #{maxBooking})
	</insert>
	
</mapper>
